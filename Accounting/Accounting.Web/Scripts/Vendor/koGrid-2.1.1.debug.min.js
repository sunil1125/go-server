function saveDataForGrid(n){var o=n!=""?n:"reportGrid",i=$("#"+o+" > div")[0],e;if(!i||!jQuery("#reportTitle").text()){console.log("Something went wrong while saving the grid");return}var r=ko.dataFor(i),t=r.sortInfo(),u=0,f=ko.observableArray();ko.utils.arrayForEach(r.columns(),function(n){n.isReorderable()&&(f.push({ColumnName:n.field,IsVisible:n.visible(),ColumnOrder:u,SortOrder:t&&t.column.field==n.field?t.direction.toString().toLowerCase()=="asc"?0:1:null,width:n.width}),u+=1)}),e={GridName:n,ColumnNameOrder:f()},saveGridInDB(e);return}function saveGridInDB(n){var t=new Simplex.AjaxConnection(Utils.Constants.AtlasBaseURL);t.post("Accounting/SetAccountingUserGridSetting",n).done(function(){}).fail(function(){console.log("Something went wrong while saving the grid")});return}(function(n){"use strict";var l;n.kg||(n.kg={}),n.kg.numberOfGrids=0,n.kg.eventStorage={};var t="__kg_selected__",i=8,c=6,u="asc",h="desc",f="_kg_field_",e="_kg_depth_",r="_kg_hidden_",o="_kg_column_",s=/<.+>/;n.kg.toggleSelection=ko.observable(null),n.kg.moveSelectionHandler=function(t,r){var e,o,f,u;return n.kg.utils.isNullOrUndefined(t)||n.kg.utils.isNullOrUndefined(t.config.selectedItems)?!0:(e=r.which||r.keyCode,o=e===38?-1:e===40?1:null,!o)?!0:(f=t.renderedRows(),u=f.indexOf(t.selectionService.lastClickedRow)+o,u<0||u>=f.length)?!0:(t.selectionService.ChangeSelection(f[u],r),u>f.length-i?t.$viewport.scrollTop(t.$viewport.scrollTop()+t.config.rowHeight*i):u<i&&t.$viewport.scrollTop(t.$viewport.scrollTop()-t.config.rowHeight*i),!1)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=this.length>>>0,t=Number(arguments[1])||0;for(t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=i);t<i;t++)if(t in this&&this[t]===n)return t;return-1}),Array.prototype.filter||(Array.prototype.filter=function(n){var i=Object(this),e=i.length>>>0,r,f,t,u;if(typeof n!="function")throw new TypeError;for(r=[],f=arguments[1],t=0;t<e;t++)t in i&&(u=i[t],n.call(f,u,t,i)&&r.push(u));return r}),n.kg.utils={visualLength:function(n){var t=document.getElementById("testDataLength");return t||(t=document.createElement("SPAN"),t.id="testDataLength",t.style.visibility="hidden",document.body.appendChild(t)),$(t).css("font",$(n).css("font")),t.innerHTML=$(n).text(),t.offsetWidth},forIn:function(n,t){for(var i in n)n.hasOwnProperty(i)&&t(n[i],i)},evalProperty:function(n,t){var f=ko.utils.unwrapObservable(n),u=t.split("."),i=0,r=ko.utils.unwrapObservable(f[u[i]]),e=u.length;for(i++;r&&i<e;)r=ko.utils.unwrapObservable(r[u[i]]),i++;return r},endsWith:function(n,t){return!n||!t||typeof n!="string"?!1:n.indexOf(t,n.length-t.length)!==-1},isNullOrUndefined:function(n){return n===undefined||n===null?!0:!1},getElementsByClassName:function(n){for(var r=[],f=new RegExp("\\b"+n+"\\b"),i=document.getElementsByTagName("*"),u,t=0;t<i.length;t++)u=i[t].className,f.test(u)&&r.push(i[t]);return r},getTemplatePromise:function(n){return $.ajax(n)},newId:function(){var n=(new Date).getTime();return function(){return n+=1}}(),ieVersion:function(){for(var n=3,t=document.createElement("div"),i=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",i[0];);return n>4?n:undefined}()},$.extend(n.kg.utils,{isIe6:function(){return n.kg.utils.ieVersion===6}(),isIe7:function(){return n.kg.utils.ieVersion===7}(),isIe:function(){return n.kg.utils.ieVersion!==undefined}()}),n.kg.defaultEmptyDataTemplate=function(){return'<div data-bind="visible: renderedRows().length > 0 ? false : true" class="kgEmptyDataTemplate"><span data-bind="text: config.emptyDataText"><\/span><\/div>'},n.kg.defaultGridTemplate=function(){return'<div data-bind="css:{\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css:{\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: \'width: 100%; height: 30px;\'"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: \'display: none; width: 100%; height: 30px;\'"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length==0">Drag a column header here and drop it to group by that column<\/div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"><\/span><span data-bind="click: function(data){$root.removeGroup($index())}" class="kgRemoveGroup">x<\/span><\/div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"><\/span><\/span><\/li><\/ul><\/div><div class="kgHeaderContainer" data-bind="style: headerStyle" style=\'width: 100%; min-height: 30px;\'><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data"><\/div><\/div><div class="" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu, css: isColMenuDisabled? \'kgHeaderButton-disabled\' : \'kgHeaderButton\'"><div style="display: inline;">Columns<\/div><img data-bind="css: isColMenuDisabled? \'kgHeaderButtonGear-disabled\':\'kgHeaderButtonGear\'"/><\/i><\/div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Seach Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/><\/div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:<\/span><ul class="kgColList" data-bind="foreach: nonAggColumns"><!-- ko if: !isListedForRemove() --><li class="kgColListItem"><label class="kgShowColumn" style="display:inline-block;" data-bind="style:{ color: isRemovable()? \'#000000\':\'#b3b3b3\' }"><input type="checkbox" class="kgColListCheckbox" data-bind="enable: isRemovable, checked: visible"/><span data-bind="text: displayName"><\/span><a title="Group By" data-bind="attr:{\'class\': groupedByClass}, visible: (field !=\'✔\') ? false:false, click: $parent.groupBy"><\/a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"><\/span><\/label><\/li><!-- /ko --><\/ul><\/div><div data-bind="visible: resetGridSettingsVisibility" class="kgRestoreButton"><input type="submit" value="Restore Defaults" class="btn" data-bind="click: resetGridSettings"/><\/div><\/div><\/div><div class="kgViewport" data-bind="css:{\'ui-widget-content\': jqueryUITheme}, style: viewportStyle">'+n.kg.defaultEmptyDataTemplate()+'<div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style:{\'top\': offsetTop, \'height\': $parent.rowHeight + \'px\'}, click: toggleSelected, css:{\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"><\/div><\/div><\/div><\/div><div class="kgFooterPanel" data-bind="css:{\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: \'width: 100%; height: 30px;\'"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css:{\'kgNoMultiSelect\': !multiSelect}"><span class="kgLabel">Total Records: <span data-bind="text: maxRowsDisplay"><\/span><\/span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"><\/span>)<\/span><\/div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span id="kgSpanFooterSelectedItems" data-bind="text: selectedItemCount"><\/span><\/span><\/div><\/div><div class="kgPagerContainer" style="float: right;margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css:{\'kgNoMultiSelect\': !multiSelect}"><div style="float: left;margin-right: 10px;" class="kgRowCountPicker" data-bind="visible: showPageSize"><span class="pageDropdownLabel">Records per page:<\/span><select class="pageDropdown" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"><\/select><\/div><div style="float: left;margin-right: 10px;line-height: 25px;" class="kgPagerControl"><button class="kgPagerButton" data-bind="click:pageToFirst,visible:enableSelectiveDisplay,css:cantPageBackward() ? \'kgPointerDisabled\':\'\'" title="First Page"><div data-bind="css: cantPageBackward() ? \'kgPagerFirstTriangleDisabled\':\'kgPagerFirstTriangle\'"><div data-bind="css: cantPageBackward() ? \'kgPagerFirstBarDisabled\':\'kgPagerFirstBar\'"><\/div><\/div><\/button><button class="kgPagerButton" data-bind="click: pageBackward,css: cantPageBackward() ? \'kgPagerFirstTriangleDisabled\':\'kgPagerFirstTriangle\'" title="Previous Page"><div class="kgPagerPrevTriangle" data-bind="visible:enableSelectiveDisplay"><\/div><\/button><input class="kgCurrentPage" data-bind="numeric: pagingOptions.currentPage, value: pagingOptions.currentPage, visible:enableSelectiveDisplay , valueUpdate: \'afterkeydown\'" maxlength="7"/><button class="kgPagerButton" data-bind="click: pageForward, css: cantPageForward() ? \'kgPagerLastTriangleDisabled\':\'kgPagerLastTriangle\'" title="Next Page"><div class="kgPagerNextTriangle" data-bind="visible:enableSelectiveDisplay"><\/div><\/button><button class="kgPagerButton" data-bind="click: pageToLast, visible:enableSelectiveDisplay,css: cantPageForward() ? \'kgPointerDisabled\':\'\'" title="Last Page"><div data-bind="css: cantPageForward() ? \'kgPagerLastTriangleDisabled\':\'kgPagerLastTriangle\'"><div data-bind="css: cantPageForward() ? \'kgPagerLastBarDisabled\':\'kgPagerLastBar\'"><\/div><\/div><\/button><\/div><\/div><\/div><\/div>'},n.kg.defaultRowTemplate=function(){return"<div data-bind=\" foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"><\/div><\/div>"},n.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index(), title: $data.getProperty($parent)}, html: $data.getProperty($parent)\"><\/div>"},n.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"><\/span> Items)<\/span><div data-bind="attr: {\'class\' : aggClass }"><\/div><\/div>'},n.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell hcol' + $index() }\"><\/div><\/div>"},n.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"><\/div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"><\/div><div data-bind=\"attr: { 'class': ' kgHeaderText' + ' kgHeaderFixed' }, html: displayName\"><\/div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ><\/div><\/div>"},ko.bindingHandlers.koGrid=function(){return{init:function(t,i,r,u,f){var o=i(),s=$(t),e,h;return o.gridDim=new n.kg.Dimension({outerHeight:ko.observable(s.height()),outerWidth:ko.observable(s.width())}),e=new n.kg.Grid(o),h=$(n.kg.defaultGridTemplate()),o.data.subscribe(function(){e.$$selectionPhase||(e.searchProvider.evalFilter(),e.refreshDomSizes())}),ko.isObservable(o.columnDefs)&&o.columnDefs.subscribe(function(n){e.columns([]),e.config.columnDefs=n,e.buildColumns(),e.configureColumnWidths()}),s.addClass("koGrid").addClass(e.gridId.toString()),s.append(h),e.$userViewModel=f.$data,ko.applyBindings(e,h[0]),n.kg.domUtilityService.AssignGridContainers(s,e),e.configureColumnWidths(),e.refreshDomSizes(),e.eventProvider=new n.kg.EventProvider(e),$.each(e.config.plugins,function(n,t){if(typeof t.onGridInit=="function")t.onGridInit(e)}),n.kg.domUtilityService.BuildStyles(e),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgRow=function(){return{init:function(t,i,r,u,f){var e=i(),h=e.$grid=f.$parent,o,s;return o=e.isAggRow?n.kg.aggregateTemplate():h.rowTemplate,s=function(n){var i=$(n);e.$userViewModel=f.$parent.$userViewModel,ko.applyBindings(e,i[0]),$(t).html(i)},o.then?o.then(function(n){s(n)}):s(o),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgCell=function(){return{init:function(n,t,i,r,u){u.$userViewModel=u.$parent.$userViewModel;var f=function(t){var i=$(t);ko.applyBindings(u,i[0]),$(n).html(i)};return r.cellTemplate.then?r.cellTemplate.then(function(n){f(n)}):f(r.cellTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgHeaderRow=function(){return{init:function(n,t,i,r,u){u.$userViewModel=u.$data.$userViewModel;var f=function(t){var i=$(t);ko.applyBindings(u,i[0]),$(n).html(i)};return r.headerRowTemplate.then?r.headerRowTemplate.then(function(n){f(n)}):f(r.headerRowTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgHeaderCell=function(){return{init:function(n,t,i,r,u){var e=u.extend({$grid:u.$parent,$userViewModel:u.$parent.$userViewModel}),f=function(t){var i=$(t);ko.applyBindings(e,i[0]),$(n).html(i)};return r.headerCellTemplate.then?r.headerCellTemplate.then(function(n){f(n)}):f(r.headerCellTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.mouseEvents=function(){return{init:function(n,t){var i=t();i.mouseDown&&$(n).mousedown(i.mouseDown)}}}(),n.kg.Aggregate=function(n,t){var i=this;i.index=0,i.offsetTop=ko.observable(0),i.entity=n,i.label=ko.observable(n.gLabel),i.field=n.gField,i.depth=n.gDepth,i.parent=n.parent,i.children=n.children,i.aggChildren=n.aggChildren,i.aggIndex=n.aggIndex,i.collapsed=ko.observable(!0),i.isAggRow=!0,i.offsetLeft=ko.observable((n.gDepth*25).toString()+"px"),i.aggLabelFilter=n.aggLabelFilter,i.toggleExpand=function(){var n=i.collapsed();i.collapsed(!n),i.notifyChildren()},i.setExpand=function(n){i.collapsed(n),i.notifyChildren()},i.notifyChildren=function(){$.each(i.aggChildren,function(n,t){if(t.entity[r]=i.collapsed(),i.collapsed()){var u=i.collapsed();t.setExpand(u)}}),$.each(i.children,function(n,t){t[r]=i.collapsed()}),t.rowCache=[];var n=!1;$.each(t.aggCache,function(t,r){if(n){var u=30*i.children.length,f=i.collapsed();r.offsetTop(f?r.offsetTop()-u:r.offsetTop()+u)}else t==i.aggIndex&&(n=!0)}),t.renderedChange()},i.aggClass=ko.computed(function(){return i.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"}),i.totalChildren=ko.computed(function(){if(i.aggChildren.length>0){var n=0,t=function(i){i.aggChildren.length>0?$.each(i.aggChildren,function(n,i){t(i)}):n+=i.children.length};return t(i),n}return i.children.length}),i.selected=ko.observable(!1),i.isEven=ko.observable(!1),i.isOdd=ko.observable(!1),i.toggleSelected=function(){return!0}},n.kg.Column=function(t,i){var r=this,f=t.colDef,c=500,e=0,o=null;r.eventTaget=undefined,r.width=f.width,r.groupIndex=ko.observable(0),r.isGroupedBy=ko.observable(!1),r.groupedByClass=ko.computed(function(){return r.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"}),r.sortable=ko.observable(!1),r.resizable=ko.observable(!1),r.minWidth=f.minWidth?f.minWidth:50,r.maxWidth=f.maxWidth?f.maxWidth:9e3,r.headerRowHeight=t.headerRowHeight,r.displayName=ko.observable(f.displayName||f.field),r.index=t.index,r.isAggCol=t.isAggCol,r.cellClass=ko.observable(f.cellClass||""),r.cellFilter=f.cellFilter||f.cellFormatter,r.field=f.field,r.aggLabelFilter=f.cellFilter||f.cellFormatter||f.aggLabelFilter||f.aggLabelFormatter,r._visible=ko.observable(n.kg.utils.isNullOrUndefined(f.visible)||f.visible),r.visible=ko.computed({read:function(){return r._visible()},write:function(n){return r.toggleVisible(n),!1}}),r._isListedForRemove=t.colDef.isListedForRemove,r.isListedForRemove=ko.computed(function(){return r.displayName()=="✔"?!0:r._isListedForRemove==undefined||typeof r._isListedForRemove=="object"?!1:r._isListedForRemove},r),r._isRemovable=t.colDef.isRemovable,r.isRemovable=ko.computed(function(){return r._isRemovable==undefined||typeof r._isRemovable=="object"?!0:r._isRemovable},r),r._isCustomColumnHeader=t.colDef.isCustomColumnHeader,r.isCustomColumnHeader=ko.computed(function(){return r._isCustomColumnHeader==undefined||typeof r._isCustomColumnHeader=="object"?!1:r._isCustomColumnHeader},r),r._isReorderable=t.colDef.isReorderable,r.isReorderable=ko.computed(function(){return r._isReorderable==undefined||typeof r._isReorderable=="object"?!0:r._isReorderable},r),t.enableSort&&r.sortable(n.kg.utils.isNullOrUndefined(f.sortable)||f.sortable),t.enableResize&&r.resizable(n.kg.utils.isNullOrUndefined(f.resizable)||f.resizable),r.sortDirection=ko.observable(undefined),r.sortingAlgorithm=f.sortFn,r.headerClass=ko.observable(f.headerClass),r.headerCellTemplate=f.headerCellTemplate||n.kg.defaultHeaderCellTemplate(),r.cellTemplate=f.cellTemplate||n.kg.defaultCellTemplate(),f.cellTemplate&&!s.test(f.cellTemplate)&&(r.cellTemplate=n.kg.utils.getTemplatePromise(f.cellTemplate)),f.headerCellTemplate&&!s.test(f.headerCellTemplate)&&(r.headerCellTemplate=n.kg.utils.getTemplatePromise(f.headerCellTemplate)),r.getProperty=function(n){return r.cellFilter?r.cellFilter(n.getProperty(r.field)):n.getProperty(r.field)},r.toggleVisible=function(t){var u;u=n.kg.utils.isNullOrUndefined(t)||typeof t=="object"?!r._visible():t,r._visible(u),i.configureColumnWidths(),n.kg.domUtilityService.BuildStyles(i),i.enableSaveGridSettings&&saveDataForGrid(i.UIGridID())},r.showSortButtonUp=ko.computed(function(){return r.sortable?r.sortDirection()===u:r.sortable}),r.showSortButtonDown=ko.computed(function(){return r.sortable?r.sortDirection()===h:r.sortable}),r.noSortVisible=ko.computed(function(){return!r.sortDirection()}),r.sort=function(){if(!r.sortable())return!0;var f;return!r.sortDirection()&&n.kg.sortService.getSortItemType&&(f=n.kg.sortService.getSortItemType(r.field,i.sortedData)||h),f||(f=r.sortDirection()===u?h:u),r.sortDirection(f),t.sortCallback(r,f),$(".noLeftBorder").parent().css("border-left","0px"),$(".noRightBorder").parent().css("border-right","0px"),!1},r.gripClick=function(n,i){i.stopPropagation(),e++,e===1?o=setTimeout(function(){e=0},c):(clearTimeout(o),t.resizeOnDataCallback(r),e=0)},r.gripOnMouseDown=function(t){if(t.stopPropagation(),t.ctrlKey)return r.toggleVisible(),n.kg.domUtilityService.BuildStyles(i),i.config.columnsChanged(i.columns.peek()),!0;r.eventTaget=t.target.parentElement,r.eventTaget.style.cursor="col-resize",r.startMousePosition=t.clientX,r.origWidth=r.width,r.minWidth=50;$(document).on("mousemove.kg-col-resize",r.onMouseMove);return+$(document).on("mouseup.kg-col-resize",r.gripOnMouseUp),!1},r.onMouseMove=function(t){t.stopPropagation();var f=t.clientX-r.startMousePosition,u=f+r.origWidth;return r.width=u<r.minWidth?r.minWidth:u>r.maxWidth?r.maxWidth:u,n.kg.domUtilityService.BuildStyles(i),!1},r.gripOnMouseUp=function(n){return n.stopPropagation(),$(document).off("mousemove.kg-col-resize"),+$(document).off("mouseup.kg-col-resize"),r.eventTaget.style.cursor=r.sortable()?"pointer":"default",r.eventTaget=undefined,i.config.columnsChanged(i.columns.peek()),i.enableSaveGridSettings&&saveDataForGrid(i.UIGridID()),!1}},n.kg.Dimension=function(n){this.outerHeight=null,this.outerWidth=null,$.extend(this,n)},n.kg.EventProvider=function(t){var i=this;i.colToMove=undefined,i.groupToMove=undefined,i.assignEvents=function(){if(t.config.jqueryUIDraggable)t.$groupPanel.droppable({addClasses:!1,drop:function(n){i.onGroupDrop(n)}}),$(document).ready(i.setDraggables);else{t.$groupPanel.on("mousedown",i.onGroupMouseDown).on("dragover",i.dragOver).on("drop",i.onGroupDrop);t.$headerScroller.on("mousedown",i.onHeaderMouseDown).on("dragover",i.dragOver).on("drop",i.onHeaderDrop);if(t.config.enableRowReordering)t.$viewport.on("mousedown",i.onRowMouseDown).on("dragover",i.dragOver).on("drop",i.onRowDrop);i.setDraggables()}t.columns.subscribe(i.setDraggables)},i.dragOver=function(n){n.preventDefault()},i.setDraggables=function(){if(t.config.jqueryUIDraggable){var r=function(n,i){var r={top:n[0].getBoundingClientRect().top,left:n[0].getBoundingClientRect().left};r.top=r.top+$("body").scrollTop(),r.left=r.left+$("body").scrollLeft();var o={top:i.position.top-r.top,left:i.position.left-r.left},u=0,s=0,f=t.visibleColumns().length,e=0,h=$(n[0]).find(".kgViewport");return $.each(t.visibleColumns(),function(n,t){var i=u+t.width/2;o.left+$(h[0]).scrollLeft()>=s&&o.left+$(h[0]).scrollLeft()<=i&&(f=n,e=u),s=u+t.width/2,u+=t.width}),f==t.visibleColumns().length&&(e=u),{idx:f,arrowPos:e}};t.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",cursorAt:{top:-5,left:-5},opacity:.85,addClasses:!1,start:function(n,t){i.onHeaderMouseDown(n,t)},drag:function(n,u){var l,e,f,a,v;if($("#kgmove_image_display_top").css("display","none"),$("#kgmove_image_display_bottom").css("display","none"),l=n.originalEvent.target,e=$(l).closest(".koGrid"),!e[0])return u.helper.find("span img").attr("src","content/images/drop-no.gif"),!0;f={top:e[0].getBoundingClientRect().top,left:e[0].getBoundingClientRect().left},f.top=f.top+$("body").scrollTop(),f.left=f.left+$("body").scrollLeft();var h=r(e,u).idx,o=r(e,u).arrowPos,s=$(e[0]).find(".kgViewport"),c=t.visibleColumns()[h]?t.visibleColumns()[h]:{isReorderable:ko.observable(t.visibleColumns()[h-1].isReorderable())};return i.colToMove.col==c||!i.colToMove.col.isReorderable()||!c.isReorderable()&&h!=t.visibleColumns().length-1||i.colToMove.col.index==c.index-1?(u.helper.find("span img").attr("src","content/images/drop-no.gif"),!0):f.left+o-s[0].scrollLeft<f.left?(u.helper.find("span img").attr("src","content/images/drop-no.gif"),!0):(u.helper.find("span img").attr("src","content/images/drop-yes.gif"),$("body").find("#kgmove_image_display_top")[0]||(a=$("<img id='kgmove_image_display_top' src='content/images/col-move-top.gif' style='z-index:1000;position:absolute;top:"+(f.top-5)+"px;left:"+(f.left+o-4-s[0].scrollLeft)+"px'>"),v=$("<img id='kgmove_image_display_bottom' src='content/images/col-move-bottom.gif' style='z-index:1000;position:absolute;top:"+(f.top- -55)+"px;left:"+(f.left+o-4-s[0].scrollLeft)+"px'>"),a.appendTo("body"),v.appendTo("body")),$("#kgmove_image_display_top").css({top:f.top-5,left:f.left+o-4-s[0].scrollLeft,display:"block"}),$("#kgmove_image_display_bottom").css({top:f.top-5+$(".kgHeaderScroller").height(),left:f.left+o-4-s[0].scrollLeft,display:"block"}),!0)},stop:function(u,f){var c,h,o,e,s;return($("#kgmove_image_display_top").css("display","none"),$("#kgmove_image_display_bottom").css("display","none"),c=u.originalEvent.target,h=$(c).closest(".koGrid"),!h[0])?!0:f.helper.find("span img").attr("src")=="content/images/drop-no.gif"?!0:(o=r(h,f).idx,e=t.visibleColumns()[o]?t.visibleColumns()[o]:{isReorderable:ko.observable(t.visibleColumns()[o-1].isReorderable()),index:o},!e||!e.isReorderable()&&o!=t.visibleColumns().length-1||i.colToMove.col==e)?!0:(s=t.columns.peek(),s.splice(i.colToMove.col.index,1),i.colToMove.col.index<e.index?s.splice(e.index-1,0,i.colToMove.col):s.splice(e.index,0,i.colToMove.col),t.fixColumnIndexes(),t.columns(s),n.kg.domUtilityService.BuildStyles(t),i.colToMove=undefined,t.enableSaveGridSettings&&saveDataForGrid(t.UIGridID()),!0)}}).droppable({})}else t.$root.find(".kgHeaderSortColumn").attr("draggable","true"),navigator.userAgent.indexOf("MSIE")!=-1&&t.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){return this.dragDrop(),!1})},i.onGroupMouseDown=function(n){var r=$(n.target),u;r[0].className!="kgRemoveGroup"?(u=ko.dataFor(r[0]),u&&(t.config.jqueryUIDraggable||r.attr("draggable","true"),i.groupToMove={header:r,groupName:u,index:u.groupIndex()-1})):i.groupToMove=undefined},i.onGroupDrop=function(n){var r,u;i.groupToMove?(r=$(n.target).closest(".kgGroupElement"),r.context.className=="kgGroupPanel"?(t.configGroups.splice(i.groupToMove.index,1),t.configGroups.push(i.groupToMove.groupName)):(u=ko.dataFor(r[0]),u&&i.groupToMove.index!=u.groupIndex()&&(t.configGroups.splice(i.groupToMove.index,1),t.configGroups.splice(u.groupIndex(),0,i.groupToMove.groupName))),i.groupToMove=undefined,t.fixGroupIndexes()):(t.configGroups.indexOf(i.colToMove.col)==-1&&(r=$(n.target).closest(".kgGroupElement"),r.context.className=="kgGroupPanel"||r.context.className=="kgGroupPanelDescription"?t.groupBy(i.colToMove.col):(u=ko.dataFor(r[0]),u&&t.removeGroup(u.groupIndex()))),i.colToMove=undefined)},i.onHeaderMouseDown=function(n,t){var r=$(n.target).closest(".kgHeaderSortColumn"),u;return r[0]?(t&&t.helper&&(t.helper.width($(t.helper.context).width()),t.helper.find(".kgHeaderText").width($(t.helper.context).find(".kgHeaderText").width()),t.helper.addClass("kgHeaderDragHelper"),t.helper.css("z-index",1e3),t.helper.find(".kgHeaderText").css("padding-left","2px"),t.helper.find(".kgHeaderText").css("padding-right","18px"),t.helper.prepend("<span style='float: left;padding-top:5px;' ><img src='content/images/drop-no.gif' />")),u=ko.dataFor(r[0]),u&&(i.colToMove={header:r,col:u}),!0):!0},i.onHeaderDrop=function(r){var e,u,f;return!i.colToMove||!i.colToMove.col.isReorderable()?!0:(e=$(r.target).closest(".kgHeaderSortColumn"),!e[0])?!0:(u=ko.dataFor(e[0]),!u||!u.isReorderable()||i.colToMove.col==u)?!0:(f=t.columns.peek(),f.splice(i.colToMove.col.index,1),f.splice(u.index,0,i.colToMove.col),t.fixColumnIndexes(),t.columns(f),n.kg.domUtilityService.BuildStyles(t),i.colToMove=undefined,t.enableSaveGridSettings&&saveDataForGrid(t.UIGridID()),!0)},i.onRowMouseDown=function(t){var i=$(t.target).closest(".kgRow"),r;i[0]&&(r=ko.dataFor(i[0]),r&&(i.attr("draggable","true"),n.kg.eventStorage.rowToMove={targetRow:i,scope:r}))},i.onRowDrop=function(i){var e=$(i.target).closest(".kgRow"),u=ko.dataFor(e[0]),r;if(u){if(r=n.kg.eventStorage.rowToMove,r.scope==u)return;var f=t.sortedData(),o=f.indexOf(r.scope.entity),s=f.indexOf(u.entity);t.sortedData.splice(o,1),t.sortedData.splice(s,0,r.scope.entity),t.searchProvider.evalFilter(),n.kg.eventStorage.rowToMove=undefined}},i.assignGridEventHandlers=function(){t.$viewport.scroll(function(n){var i=n.target.scrollLeft,r=n.target.scrollTop;t.adjustScrollLeft(i),t.adjustScrollTop(r)}),t.$viewport.off("keydown");t.$viewport.on("keydown",function(i){return n.kg.moveSelectionHandler(t,i)});t.config.tabIndex===-1?(t.$viewport.attr("tabIndex",n.kg.numberOfGrids),n.kg.numberOfGrids++):t.$viewport.attr("tabIndex",t.config.tabIndex),$(n).resize(function(){n.kg.domUtilityService.UpdateGridLayout(t),typeof t.config!="undefined"&&t.config.maintainColumnRatios&&t.configureColumnWidths()})},i.assignGridEventHandlers(),i.assignEvents()},n.kg.RowFactory=function(u){var s=this;s.rowCache=[],s.aggCache={},s.parentCache=[],s.dataChanged=!0,s.parsedData=[],s.rowConfig={},s.selectionService=u.selectionService,s.numberOfAggregates=0,s.groupedData=undefined,s.rowHeight=u.config.rowHeight,s.rowConfig={canSelectRows:u.config.canSelectRows,rowClasses:u.config.rowClasses,selectedItems:u.config.selectedItems,selectWithCheckboxOnly:u.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:u.config.beforeSelectionChange,afterSelectionChangeCallback:u.config.afterSelectionChange},s.renderedRange=new n.kg.Range(0,u.minRowsToRender()+i),s.buildEntityRow=function(i,r){var u=s.rowCache[r];return u||(u=new n.kg.Row(i,s.rowConfig,s.selectionService),u.rowIndex(r+1),u.offsetTop((s.rowHeight*r).toString()+"px"),u.selected(i[t]),s.rowCache[r]=u),u},s.buildAggregateRow=function(t,i){var r=s.aggCache[t.aggIndex];return r||(r=new n.kg.Aggregate(t,s),s.aggCache[t.aggIndex]=r),r.index=i+1,r.offsetTop((s.rowHeight*i).toString()+"px"),r},s.UpdateViewableRange=function(n){s.renderedRange=n,s.renderedChange()},s.filteredDataChanged=function(){u.lateBoundColumns&&u.filteredData().length>1&&(u.config.columnDefs=undefined,u.buildColumns(),u.lateBoundColumns=!1),s.dataChanged=!0,s.rowCache=[],u.config.groups.length>0&&s.getGrouping(u.config.groups),s.renderedRange.bottomRow=u.minRowsToRender(),s.UpdateViewableRange(s.renderedRange)},s.renderedChange=function(){if(!s.groupedData||u.config.groups.length<1){s.renderedChangeNoGroups(),u.refreshDomSizes();return}s.parentCache=[];var n=[],t=s.parsedData.filter(function(n){return n[r]===!1}).slice(s.renderedRange.topRow,s.renderedRange.bottomRow);$.each(t,function(t,i){var r;r=i.isAggRow?s.buildAggregateRow(i,s.renderedRange.topRow+t):s.buildEntityRow(i,s.renderedRange.topRow+t),n.push(r)}),u.setRenderedRows(n),u.refreshDomSizes()},s.renderedChangeNoGroups=function(){var n=[],t=u.filteredData.slice(s.renderedRange.topRow,s.renderedRange.bottomRow);$.each(t,function(t,i){var r=s.buildEntityRow(i,s.renderedRange.topRow+t);n.push(r)}),u.setRenderedRows(n)},s.parseGroupData=function(n){var i,t;if(n.values)$.each(n.values,function(n,t){s.parentCache[s.parentCache.length-1].children.push(t),s.parsedData.push(t)});else for(i in n)if(i==f||i==e||i==o)continue;else n.hasOwnProperty(i)&&(t=s.buildAggregateRow({gField:n[f],gLabel:i,gDepth:n[e],isAggRow:!0,_kg_hidden_:!1,children:[],aggChildren:[],aggIndex:s.numberOfAggregates,aggLabelFilter:n[o].aggLabelFilter},0),s.numberOfAggregates++,t.parent=s.parentCache[t.depth-1],t.parent&&(t.parent.collapsed(!1),t.parent.aggChildren.push(t)),s.parsedData.push(t.entity),s.parentCache[t.depth]=t,s.parseGroupData(n[i]))},s.getGrouping=function(t){s.aggCache=[],s.rowCache=[],s.numberOfAggregates=0,s.groupedData={};var h=u.filteredData(),c=t.length,i=u.columns();$.each(h,function(h,l){l[r]=!0;var a=s.groupedData;$.each(t,function(t,r){!i[t].isAggCol&&t<=c&&(u.columns.splice(l.gDepth,0,new n.kg.Column({colDef:{field:"",width:25,sortable:!1,resizable:!1,headerCellTemplate:'<div class="kgAggHeader"><\/div>'},isAggCol:!0,index:l.gDepth,headerRowHeight:u.config.headerRowHeight})),n.kg.domUtilityService.BuildStyles(u));var h=i.filter(function(n){return n.field==r})[0],s=n.kg.utils.evalProperty(l,r);h.cellFilter&&(s=h.cellFilter(s)),s=s?s.toString():"null",a[s]||(a[s]={}),a[f]||(a[f]=r),a[e]||(a[e]=t),a[o]||(a[o]=h),a=a[s]}),a.values||(a.values=[]),a.values.push(l)}),u.fixColumnIndexes(),s.parsedData.length=0,s.parseGroupData(s.groupedData)},u.config.groups.length>0&&u.filteredData().length>0&&s.getGrouping(u.config.groups)},n.kg.Grid=function(u){var e={rowHeight:30,columnWidth:100,headerRowHeight:30,footerRowHeight:30,footerVisible:!0,displayFooter:undefined,canSelectRows:!1,selectAllState:ko.observable(!1),data:ko.observableArray([]),columnDefs:undefined,selectedItems:ko.observableArray([]),displaySelectionCheckbox:!1,selectWithCheckboxOnly:!1,useExternalSorting:!1,sortInfo:ko.observable(undefined),triggerRestore:ko.observable(undefined),multiSelect:!0,tabIndex:-1,enableColumnResize:!0,enableSorting:!0,maintainColumnRatios:undefined,beforeSelectionChange:function(){return!0},afterSelectionChange:function(){},columnsChanged:function(){},rowTemplate:undefined,headerRowTemplate:undefined,jqueryUITheme:!0,jqueryUIDraggable:!0,plugins:[],keepLastSelected:!0,groups:[],showGroupPanel:!1,enableRowReordering:!1,showColumnMenu:!0,showFilter:!0,resetGridSettingsVisibility:!1,showPageSize:!0,enableSaveGridSettings:!0,disableTextSelection:!0,filterOptions:{filterText:ko.observable(""),useExternalFilter:!1},enablePaging:ko.observable(!1),pagingOptions:{pageSizes:ko.observableArray([250,500,1e3]),pageSize:ko.observable(250),totalServerItems:ko.observable(0),currentPage:ko.observable(1)},removeCellBorder:!1,enablePaginationBlocks:!1,enableSelectiveDisplay:!0,emptyDataText:"No data found.",viewPortOptions:{isfixed:ko.observable(!1),minRows:ko.observable(5),maxRows:ko.observable(10)},isColMenuDisabled:!0,isHeaderHeightFixed:!1,UIGridID:ko.observable("")},f=this;f.maxCanvasHt=ko.observable(0),f.isColMenuDisabled=u.isColMenuDisabled?u.isColMenuDisabled:!1,f.enableSelectiveDisplay=!0,f.config=$.extend(!0,e,u),f.config.columnDefs=ko.utils.unwrapObservable(u.columnDefs),f.gridId="ng"+n.kg.utils.newId(),f.$root=null,f.$groupPanel=null,f.$topPanel=null,f.$headerContainer=null,f.$headerScroller=null,f.$headers=null,f.$viewport=null,f.$canvas=null,f.rootDim=f.config.gridDim,f.sortInfo=ko.isObservable(f.config.sortInfo)?f.config.sortInfo:ko.observable(f.config.sortInfo),f.triggerRestore=f.config.triggerRestore,f.sortedData=f.config.data,f.lateBindColumns=!1,f.filteredData=ko.observableArray([]),f.lastSortedColumn=undefined,f.showFilter=f.config.showFilter,f.resetGridSettingsVisibility=f.config.resetGridSettingsVisibility,f.removeCellBorder=f.config.removeCellBorder,f.showPageSize=f.config.showPageSize,f.enableSaveGridSettings=f.config.enableSaveGridSettings,f.filterText=f.config.filterOptions.filterText,f.disableTextSelection=ko.observable(f.config.disableTextSelection),f.calcMaxCanvasHeight=function(){return f.configGroups().length>0?f.rowFactory.parsedData.filter(function(n){return n[r]===!1}).length*f.config.rowHeight:f.filteredData().length*f.config.rowHeight},f.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0},f.UIGridID=f.config.UIGridID,f.setRenderedRows=function(n){f.renderedRows(n),f.$root!=null&&(f.elementDims.rootMaxW=f.$root.width()),f.$root!=null&&(f.elementDims.rootMaxH=f.$root.height()),f.refreshDomSizes()},f.minRowsToRender=function(){var n=f.viewportDimHeight()||1;return Math.floor(n/f.config.rowHeight)},f.refreshDomSizes=function(){f.rootDim.outerWidth(f.elementDims.rootMaxW),f.rootDim.outerHeight(f.elementDims.rootMaxH),f.maxCanvasHt(f.calcMaxCanvasHeight())},f.buildColumnDefsFromData=function(){var i=f.sortedData(),r;if(f.config.columnDefs||(f.config.columnDefs=[]),!i||!i[0]){f.lateBoundColumns=!0;return}r=i[0],n.kg.utils.forIn(r,function(n,i){i!=t&&f.config.columnDefs.push({field:i})})},f.buildColumns=function(){var t=f.config.columnDefs,i=[];t||(f.buildColumnDefsFromData(),t=f.config.columnDefs),f.config.displaySelectionCheckbox&&f.config.canSelectRows&&t.length>0&&t[0].field!="✔"&&t.splice(0,0,{field:"✔",width:f.elementDims.rowSelectedCellW,sortable:!1,resizable:!1,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected, click: $grid.toggleallSelected"/>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /><\/div>'}),t.length>0&&($.each(t,function(t,r){var u=new n.kg.Column({colDef:r,index:t,headerRowHeight:f.config.headerRowHeight,sortCallback:f.sortData,resizeOnDataCallback:f.resizeOnData,enableResize:f.config.enableColumnResize,enableSort:f.config.enableSorting},f),e;u.sortDirection(r.sortDirection),i.push(u),e=f.config.groups.indexOf(r.field),e!=-1&&f.configGroups.splice(e,0,u)}),f.columns(i))},f.configureColumnWidths=function(){var h=f.config.columnDefs,l=h.length,i=[],o=[],r=0,s=0,t=f.columns(),u,e,c;$.each(h,function(u,e){var c=!1,h=undefined,l;if(n.kg.utils.isNullOrUndefined(e.width)?e.width="*":(c=isNaN(e.width)?n.kg.utils.endsWith(e.width,"%"):!1,h=c?e.width:parseInt(e.width,10)),isNaN(h)&&t[u].visible()==!0){if(h=e.width,h=="auto"){t[u].width=t[u].minWidth,l=t[u],$(document).ready(function(){f.resizeOnData(l,!0)});return}if(h.indexOf("*")!=-1){r+=h.length,e.index=u,i.push(e);return}if(c){e.index=u,o.push(e);return}throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid';}else isNaN(h)||t[u].visible()!=!0||(s+=t[u].width=parseInt(e.width,10))}),i.length>0&&(f.config.maintainColumnRatios===!1?$.noop():f.config.maintainColumnRatios=!0,u=f.rootDim.outerWidth()-s,e=Math.floor(u/r),e<=25&&(e=25),c=u%r>0?u%r:0,$.each(i,function(r,u){var h=u.width.length,o;t[u.index].width=e*h,r+1==i.length&&(o=2,f.maxCanvasHt()>f.viewportDimHeight()&&(o+=n.kg.domUtilityService.ScrollW),t[u.index].width-=o,t[u.index].width+=c),s+=t[u.index].width})),o.length>0&&$.each(o,function(n,i){var r=i.width;t[i.index].width=Math.floor(f.rootDim.outerWidth()*(parseInt(r.slice(0,-1),10)/100))}),f.columns(t),n.kg.domUtilityService.BuildStyles(f)},f.init=function(){f.selectionService=new n.kg.SelectionService(f),f.rowFactory=new n.kg.RowFactory(f),f.selectionService.Initialize(f.rowFactory),f.searchProvider=new n.kg.SearchProvider(f),f.styleProvider=new n.kg.StyleProvider(f),f.buildColumns(),n.kg.sortService.columns=f.columns,f.configGroups.subscribe(function(n){if(n){var t=[];$.each(n,function(n,i){i&&t.push(i.field||i)}),f.config.groups=t,f.rowFactory.filteredDataChanged()}}),f.filteredData.subscribe(function(){var i,n;if(!f.$$selectionPhase){for(f.maxCanvasHt(f.calcMaxCanvasHeight()),f.isSorting||f.configureColumnWidths(),i=0,n=0;n<f.filteredData().length;n++)f.filteredData()[n][t]!==undefined&&f.filteredData()[n][t]==!0&&i++;f.filteredData().length==i&&i>0?f.allSelected(!0):f.allSelected(!1)}}),f.maxCanvasHt(f.calcMaxCanvasHeight()),f.searchProvider.evalFilter(),f.refreshDomSizes()},f.prevScrollTop=0,f.prevScrollIndex=0,f.adjustScrollTop=function(t,r){if(f.prevScrollTop!==t||r){var u=Math.floor(t/f.config.rowHeight);f.prevScrollTop<t&&u<f.prevScrollIndex+c||f.prevScrollTop>t&&u>f.prevScrollIndex-c||(f.prevScrollTop=t,f.rowFactory.UpdateViewableRange(new n.kg.Range(Math.max(0,u-i),u+f.minRowsToRender()+i)),f.prevScrollIndex=u)}},f.adjustScrollLeft=function(n){f.$headerContainer&&f.$headerContainer.scrollLeft(n)},f.resizeOnData=function(t){var i=t.minWidth,r=n.kg.utils.getElementsByClassName("col"+t.index);$.each(r,function(t,r){var u,f,e;t===0?(f=$(r).find(".kgHeaderText"),u=n.kg.utils.visualLength(f)+10):(e=$(r).find(".kgCellText"),u=n.kg.utils.visualLength(e)+10),u>i&&(i=u)}),t.width=i=Math.min(Number(t.maxWidth.replace("px","")),i+7),n.kg.domUtilityService.BuildStyles(f)},f.sortData=function(t,i){if(f.isSorting=!0,f.sortInfo({column:t,direction:i}),f.clearSortingData(t),f.config.useExternalSorting)f.config.sortInfo(f.sortInfo.peek());else{var r=f.sortedData;f.config.fullDataObject&&f.config.fullDataObject()&&f.config.fullDataObject().length&&(r=f.config.fullDataObject),n.kg.sortService.Sort(f.sortInfo.peek(),r),f.config.fullDataObject&&f.config.fullDataObject()&&f.config.fullDataObject().length&&f.sortedData(f.config.fullDataObject.slice((f.config.pagingOptions.currentPage()-1)*f.config.pagingOptions.pageSize(),f.config.pagingOptions.currentPage()*f.config.pagingOptions.pageSize()))}f.lastSortedColumn=t,f.enableSaveGridSettings&&saveDataForGrid(f.UIGridID()),f.isSorting=!1},f.resetGridSettings=function(){f.triggerRestore()===!0?f.triggerRestore(!1):f.triggerRestore(!0),f.enableSaveGridSettings&&saveDataForGrid(f.UIGridID())},f.clearSortingData=function(n){if(n)if(f.lastSortedColumn&&n!=f.lastSortedColumn)f.lastSortedColumn.sortDirection("");else{var t=$.grep(f.columns(),function(t){return t.sortDirection()!==""&&t.sortable()===!0&&t!==n});t&&t.length>0&&t[0].sortDirection("")}else $.each(f.columns(),function(n,t){t.sortDirection("")})},f.fixColumnIndexes=function(){f.$$indexPhase=!0;var n=f.columns.peek();$.each(n,function(n,t){t.index=n}),f.$$indexPhase=!1},f.elementsNeedMeasuring=!0,f.columns=ko.observableArray([]),f.columns.subscribe(function(n){f.config.columnsChanged(n)}),f.renderedRows=ko.observableArray([]),f.headerRow=null,f.rowHeight=f.config.rowHeight,f.jqueryUITheme=ko.observable(f.config.jqueryUITheme),f.footer=null,f.selectedItems=f.config.selectedItems,f.multiSelect=f.config.multiSelect,f.footerVisible=n.kg.utils.isNullOrUndefined(f.config.displayFooter)?f.config.footerVisible:f.config.displayFooter,f.config.footerRowHeight=f.footerVisible?f.config.footerRowHeight:0,f.showColumnMenu=f.config.showColumnMenu,f.showMenu=ko.observable(!1),f.configGroups=ko.observableArray([]),f.enableSelectiveDisplay=f.config.enableSelectiveDisplay,f.enablePaging=f.config.enablePaging,f.pagingOptions=f.config.pagingOptions,f.enablePaginationBlocks=ko.computed(function(){if(f.config.pagingOptions.totalServerItems()>f.config.pagingOptions.pageSize())return!0}),f.rowTemplate=f.config.rowTemplate||n.kg.defaultRowTemplate(),f.headerRowTemplate=f.config.headerRowTemplate||n.kg.defaultHeaderRowTemplate(),f.config.rowTemplate&&!s.test(f.config.rowTemplate)&&(f.rowTemplate=n.kg.utils.getTemplatePromise(f.config.rowTemplate)),f.config.headerRowTemplate&&!s.test(f.config.headerRowTemplate)&&(f.headerRowTemplate=n.kg.utils.getTemplatePromise(f.config.headerRowTemplate)),f.visibleColumns=ko.computed(function(){var n=f.columns();return n.filter(function(n){return n.visible()})}),f.nonAggColumns=ko.computed(function(){return f.columns().filter(function(n){return!n.isAggCol})}),f.toggleShowMenu=function(){f.isColMenuDisabled?f.showMenu(!1):f.showMenu(!f.showMenu())},f.showMenu.subscribe(function(n){var t=function(n){if(n.target.parentNode&&n.target.parentNode.classList&&n.target.parentNode.classList.length){if(n.target.parentNode.classList.contains("kgHeaderButton"))return;if(n.target.parentNode.classList.contains("kgColMenu")||n.target.className=="kgColMenu"||n.target.parentNode.classList.contains("kgColList")||n.target.className=="kgColList"||n.target.parentNode.classList.contains("kgShowColumn")||n.target.className=="kgShowColumn"||n.target.className=="kgMenuText")return}n.target.className!="kgColMenu"&&n.target.className!="btn"&&n.target.className!="kgColList"&&n.target.className!="kgShowColumn"&&n.target.className!="kgMenuText"&&f.showMenu(!1)};if(n)$(document).on("mousedown",$.proxy(t,f));else $(document).off("mousedown",t)});$("#reportrange").on("click",function(){f.showMenu(!1)});$("#VerticalOptionButtonGroup").on("click",function(){f.showMenu(!1)});f.allSelected=f.config.selectAllState,n.kg.toggleSelection.subscribe(function(t){typeof f.allSelected!="undefined"&&t!=null&&(f.allSelected(t),f.selectionService.toggleSelectAll(f.allSelected()),f.config.afterSelectionChange(f.selectedItems.peek(),this),n.kg.toggleSelection(null))}),f.toggleallSelected=function(){return f.config.beforeSelectionChange(f.sortedData.peek(),this)&&(f.selectionService.toggleSelectAll(f.allSelected()),f.config.afterSelectionChange(f.selectedItems.peek(),this)),!0},f.totalFilteredItemsLength=ko.computed(function(){return f.filteredData().length}),f.showGroupPanel=ko.computed(function(){return f.config.showGroupPanel}),f.topPanelHeight=ko.observable(f.config.showGroupPanel===!0?f.config.headerRowHeight*2+1:f.config.headerRowHeight),f.viewportDimHeight=ko.computed(function(){var r=f.rootDim.outerHeight()-f.topPanelHeight()-f.config.footerRowHeight-2,t=0,i;return ko.unwrap(f.config.viewPortOptions.isfixed)?t=ko.unwrap(f.config.viewPortOptions.maxRows)*f.config.rowHeight:(f.filteredData().length>=ko.unwrap(f.config.viewPortOptions.minRows)&&(t=f.filteredData().length*f.config.rowHeight),f.filteredData().length<ko.unwrap(f.config.viewPortOptions.minRows)&&(t=ko.unwrap(f.config.viewPortOptions.minRows)*f.config.rowHeight)),t===0&&(t=ko.unwrap(f.config.viewPortOptions.minRows)*f.config.rowHeight),i=0,f.$viewport!==undefined&&f.$viewport!==null&&f.totalRowWidth()>f.rootDim.outerWidth()&&(i+=n.kg.domUtilityService.ScrollW),Math.max(0,t+i)}),f.groupBy=function(t){if(!(f.sortedData().length<1)){var i=f.configGroups().indexOf(t);i==-1?(t.isGroupedBy(!0),f.configGroups.push(t),t.groupIndex(f.configGroups().length)):f.removeGroup(i),n.kg.domUtilityService.BuildStyles(f)}},f.removeGroup=function(t){var i=f.columns().filter(function(n){return n.groupIndex()==t+1})[0];i.isGroupedBy(!1),i.groupIndex(0),f.columns.splice(t,1),f.configGroups.splice(t,1),f.fixGroupIndexes(),f.configGroups().length===0&&f.fixColumnIndexes(),n.kg.domUtilityService.BuildStyles(f)},f.fixGroupIndexes=function(){$.each(f.configGroups(),function(n,t){t.groupIndex(n+1)})},f.totalRowWidth=function(){var n=0,t=f.visibleColumns();return $.each(t,function(t,i){n+=i.width}),n},f.headerScrollerDim=function(){var i=f.viewportDimHeight(),r=f.maxCanvasHt(),u=r>i,t=new n.kg.Dimension;return t.autoFitHeight=!0,t.outerWidth=f.totalRowWidth(),u?t.outerWidth+=f.elementDims.scrollW:r-i<=f.elementDims.scrollH&&(t.outerWidth+=f.elementDims.scrollW),t},f.jqueryUITheme=f.config.jqueryUITheme,f.maxRows=ko.observable(Math.max(f.config.pagingOptions.totalServerItems()||f.sortedData().length,0)),f.maxRowsDisplay=ko.computed(function(){return f.maxRows()}),f.multiSelect=ko.observable(f.config.canSelectRows&&f.config.multiSelect),f.selectedItemCount=ko.computed(function(){return f.selectedItems().length}),f.maxPages=ko.computed(function(){return f.maxRows(Math.max(f.config.pagingOptions.totalServerItems()||f.sortedData().length,0)),Math.ceil(f.maxRows()/f.pagingOptions.pageSize())}),f.pageForward=function(){var n=+f.config.pagingOptions.currentPage();f.config.pagingOptions.currentPage(Math.min(n+1,f.maxPages()))},f.pageBackward=function(){var n=+f.config.pagingOptions.currentPage();f.config.pagingOptions.currentPage(Math.max(n-1,1))},f.pageToFirst=function(){f.config.pagingOptions.currentPage(1)},f.pageToLast=function(){var n=f.maxPages();f.config.pagingOptions.currentPage(n)},f.cantPageForward=ko.computed(function(){var n=f.config.pagingOptions.currentPage(),t=f.maxPages();return!(n<t)}),f.cantPageBackward=ko.computed(function(){var n=f.config.pagingOptions.currentPage();return!(n>1)}),f.maxPages.subscribe(function(n){if(n&&!f.config.filterOptions.useExternalFilter&&f.filterText()&&f.filterText().length>0){var t=f.config.pagingOptions.currentPage();t>n&&f.config.pagingOptions.currentPage(n)}}),f.pagingOptions.pageSize.subscribe(function(){f.removeCellBorder&&($(".noLeftBorder").parent().css("border-left","0px"),$(".noRightBorder").parent().css("border-right","0px"))}),f.init()},kg.Range=function(n,t){this.topRow=n,this.bottomRow=t},n.kg.Row=function(i,r,u){var f=this;f.canSelectRows=r.canSelectRows,f.rowClasses=r.rowClasses,f.selectedItems=r.selectedItems,f.entity=i,f.selectionService=u,f.selected=ko.observable(!1),f.continueSelection=function(n){f.selectionService.ChangeSelection(f,n)},f.toggleSelected=function(n,t){if(!f.canSelectRows)return!0;var i=t.target||t;return(i.type=="checkbox"&&f.selected(!f.selected()),r.selectWithCheckboxOnly&&i.type!="checkbox")?!0:f.beforeSelectionChange(f,t)?(f.continueSelection(t),f.afterSelectionChange(f,t)):!1},f.entity[t]===undefined?f.entity[t]=!1:f.selectionService.setSelection(f,f.entity[t]),f.rowIndex=ko.observable(0),f.offsetTop=ko.observable("0px"),f.rowDisplayIndex=0,f.isEven=ko.computed(function(){return f.rowIndex()%2==0?!0:!1}),f.isOdd=ko.computed(function(){return f.rowIndex()%2!=0?!0:!1}),f.beforeSelectionChange=r.beforeSelectionChangeCallback,f.afterSelectionChange=r.afterSelectionChangeCallback,f.propertyCache={},f.getProperty=function(t){return f.propertyCache[t]||(f.propertyCache[t]=n.kg.utils.evalProperty(f.entity,t))}},n.kg.SearchProvider=function(n){var t=this,i=[],u,r;t.extFilter=n.config.filterOptions.useExternalFilter,t.showFilter=n.config.showFilter,t.resetGridSettingsVisibility=n.resetGridSettingsVisibility,t.removeCellBorder=n.removeCellBorder,t.showPageSize=n.showPageSize,t.enableSaveGridSettings=n.enableSaveGridSettings,t.filterText=n.config.filterOptions.filterText,t.throttle=n.config.filterOptions.filterThrottle,t.fieldMap={},r=n.config.pagingOptions,t.evalFilter=function(){var u=ko.observableArray([]),f=n.sortedData;!t.extFilter&&n.config.fullDataObject&&n.config.fullDataObject()&&n.config.fullDataObject().length&&(f=n.config.fullDataObject),i.length===0?u(f.peek().filter(function(n){return!n._destroy})):u(f.peek().filter(function(r){var f,h,u,e,c,o,s;if(r._destroy)return!1;for(f=0,h=i.length;f<h;f++){if(u=i[f],!u.column){for(e in r)if(r.hasOwnProperty(e)&&(c=ko.utils.arrayFirst(n.columns(),function(n){return n.field===e&&n._visible()===!0}),c&&(o=ko.utils.unwrapObservable(r[e]),o&&u.regex.test(o.toString()))))return!0;return!1}if(s=ko.utils.unwrapObservable(r[u.column])||ko.utils.unwrapObservable(r[t.fieldMap[u.columnDisplay]]),!s||!u.regex.test(s.toString()))return!1}return!0})),!t.extFilter&&n.config.fullDataObject&&n.config.fullDataObject()&&n.config.fullDataObject().length?(n.filteredData(u.slice((r.currentPage()-1)*r.pageSize(),r.currentPage()*r.pageSize())),r.totalServerItems(u().length)):n.filteredData(u()),n.rowFactory.filteredDataChanged()};var f=function(n,t){try{return new RegExp(n,t)}catch(i){return new RegExp(n.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}},e=function(n){var t,r;(i=[],t=$.trim(n))&&(r=t.split(";"),$.each(r,function(n,t){var r=t.split(":"),u,e,o;r.length>1?(u=$.trim(r[0]),e=$.trim(r[1]),u&&e&&i.push({column:u,columnDisplay:u.replace(/\s+/g,"").toLowerCase(),regex:f(e,"i")})):(o=$.trim(r[0]),o&&i.push({column:"",regex:f(o,"i")}))}))},o=ko.computed(function(){var n=t.filterText();t.extFilter||n==u||(u=n,e(n),t.evalFilter())});typeof t.throttle=="number"&&o.extend({throttle:t.throttle}),t.extFilter||n.columns.subscribe(function(n){$.each(n,function(n,i){t.fieldMap[i.displayName().toLowerCase().replace(/\s+/g,"")]=i.field})})},n.kg.SelectionService=function(i){var r=this;r.multi=i.config.multiSelect,r.selectedItems=i.config.selectedItems,r.selectedIndex=i.config.selectedIndex,r.lastClickedRow=undefined,r.ignoreSelectedItemChanges=!1,r.rowFactory={},r.Initialize=function(n){r.rowFactory=n},r.ChangeSelection=function(u,f){var s,e,o,h;if(i.$$selectionPhase=!0,f&&f.shiftKey&&r.multi){if(r.lastClickedRow){if(s=i.filteredData.indexOf(u.entity),e=i.filteredData.indexOf(r.lastClickedRow.entity),s==e)return!1;for(e++,s<e&&(s=s^e,e=s^e,s=s^e),o=[];e<=s;e++)o.push(r.rowFactory.rowCache[e]);return o[o.length-1].beforeSelectionChange(o,f)&&($.each(o,function(n,i){i.selected(!0),i.entity[t]=!0,r.selectedItems.indexOf(i.entity)===-1&&r.selectedItems.push(i.entity)}),o[o.length-1].afterSelectionChange(o,f)),r.lastClickedRow=o[o.length-1],!0}}else r.multi?r.setSelection(u,!u.selected()):(h=undefined,n.kg.selectedCarrier&&(h=$.grep(i.renderedRows(),function(t){return t.selectedItems()[0].CarrierId===n.kg.selectedCarrier.CarrierId&&t.selected()})[0]),h!==undefined?r.setSelection(h,!1):r.lastClickedRow&&r.lastClickedRow!=u&&r.setSelection(r.lastClickedRow,!1),r.setSelection(u,i.config.keepLastSelected?!0:!u.selected()));return i.filteredData().length==i.selectedItemCount()&&i.selectedItemCount()>0?i.allSelected(!0):i.allSelected(!1),r.lastClickedRow=u,i.$$selectionPhase=!1,!0},r.setSelection=function(n,i){if(n.selected(i),n.entity[t]=i,i)r.selectedItems.indexOf(n.entity)===-1&&r.selectedItems.push(n.entity);else{var u=r.selectedItems.indexOf(n.entity);u!==-1&&r.selectedItems.splice(u,1)}},r.toggleSelectAll=function(n){var u=r.selectedItems().length;$.each(i.filteredData(),function(i,u){if(u[t]=n,n)r.selectedItems.indexOf(u)===-1&&r.selectedItems.push(u);else{var f=r.selectedItems.indexOf(u);f!==-1&&r.selectedItems.splice(f,1)}}),$.each(r.rowFactory.rowCache,function(t,i){i&&i.selected&&i.selected(n)})}},n.kg.StyleProvider=function(t){t.canvasStyle=ko.computed(function(){return{height:t.maxCanvasHt().toString()+"px"}}),t.headerScrollerStyle=ko.computed(function(){return{"min-height":t.config.headerRowHeight+"px"}}),t.topPanelStyle=ko.computed(function(){return{width:t.rootDim.outerWidth()+2+"px",height:t.topPanelHeight()+"px"}}),t.headerStyle=ko.computed(function(){var i=0,r="";return i=Math.max(0,t.rootDim.outerWidth()-n.kg.domUtilityService.ScrollW),r=i&&i!==0?i+"px":"auto",{width:r,"min-height":t.config.headerRowHeight+"px"}}),t.viewportStyle=ko.computed(function(){var n=0,i="";return n=t.rootDim.outerWidth(),i=n&&n!==0?n+"px":"auto",{width:i,height:t.viewportDimHeight()+"px"}}),t.footerStyle=ko.computed(function(){var n=0,i="";return n=t.rootDim.outerWidth(),i=n&&n!==0?n+"px":"auto",{width:i,height:t.config.footerRowHeight+"px"}})},n.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,alphaRE:/[^a-zA-Z]/g,numberRE:/[^0-9]/g,guessSortFn:function(t){var i,u,r,f,e;if(t===undefined||t===null||t==="")return null;u=typeof t;switch(u){case"number":i=n.kg.sortService.sortNumber;break;case"boolean":i=n.kg.sortService.sortBool;break;default:i=undefined}return i?i:Object.prototype.toString.call(t)==="[object Date]"?n.kg.sortService.sortDate:u!=="string"?n.kg.sortService.basicSort:t.match(/^-?[£$¤]?[\d,.]+%?$/)?n.kg.sortService.sortAlphaNumeric:(r=t.match(n.kg.sortService.dateRE),r)?(f=parseInt(r[1],10),e=parseInt(r[2],10),f>12?n.kg.sortService.sortDDMMStr:e>12?n.kg.sortService.sortMMDDStr:n.kg.sortService.sortMMDDStr):n.kg.sortService.sortAlpha},basicSort:function(n,t){return n==t?0:n<t?-1:1},sortNumber:function(n,t){return n-t},sortNumberStr:function(n,t){var i,r,u=!1,f=!1;return(i=parseFloat(n.replace(/[^0-9.-]/g,"")),isNaN(i)&&(u=!0),r=parseFloat(t.replace(/[^0-9.-]/g,"")),isNaN(r)&&(f=!0),u&&f)?0:u?1:f?-1:i-r},sortAlpha:function(t,i){return n.kg.sortService.sortAlphaNumeric(t,i)},sortAlphaNumeric:function(t,i){var f=t?t.toLowerCase().replace(n.kg.sortService.alphaRE,""):t,e=i?i.toLowerCase().replace(n.kg.sortService.alphaRE,""):i,r,u;return f===e?(r=parseInt(t.replace(n.kg.sortService.numberRE,""),10),u=parseInt(i.replace(n.kg.sortService.numberRE,""),10),r===u?0:r>u?1:-1):f>e?1:-1},sortBool:function(n,t){return n&&t?0:n||t?n?1:-1:0},sortDate:function(n,t){var i=n.getTime(),r=t.getTime();return i==r?0:i<r?-1:1},sortDDMMStr:function(t,i){var o,s,f,r,u,e;return(f=t.match(n.kg.sortService.dateRE),e=f[3],r=f[2],u=f[1],r.length==1&&(r="0"+r),u.length==1&&(u="0"+u),o=e+r+u,f=i.match(n.kg.sortService.dateRE),e=f[3],r=f[2],u=f[1],r.length==1&&(r="0"+r),u.length==1&&(u="0"+u),s=e+r+u,o==s)?0:o<s?-1:1},sortMMDDStr:function(t,i){var o,s,r,u,f,e;return(r=n.kg.sortService.getDateMatch(t),!r)?1:(e=r[3],f=r[2],u=r[1],u.length==1&&(u="0"+u),f.length==1&&(f="0"+f),o=e+u+f,r=n.kg.sortService.getDateMatch(i),!r)?1:(e=r[3],f=r[2],u=r[1],u.length==1&&(u="0"+u),f.length==1&&(f="0"+f),s=e+u+f,o==s)?0:o<s?-1:1},sortData:function(t,i){var e=t(),r,s,f,o;if(e&&i){if(r=i.column,s=i.direction,n.kg.sortService.colSortFnCache[r.field])f=n.kg.sortService.colSortFnCache[r.field];else if(r.sortingAlgorithm!=undefined)f=r.sortingAlgorithm,n.kg.sortService.colSortFnCache[r.field]=r.sortingAlgorithm;else{if(o=e[0],!o)return;f=kg.sortService.guessSortFn(o[r.field]),f?n.kg.sortService.colSortFnCache[r.field]=f:f=n.kg.sortService.sortAlpha}e.sort(function(t,i){var e=n.kg.utils.evalProperty(t,r.field),o=n.kg.utils.evalProperty(i,r.field);if(o||e)if(e){if(!o)return-1}else return 1;else return 0;return s===u?f(e,o):0-f(e,o)}),t(e);return}},Sort:function(t,i){n.kg.sortService.isSorting||(n.kg.sortService.isSorting=!0,n.kg.sortService.sortData(i,t),n.kg.sortService.isSorting=!1)},getDateMatch:function(t){var i,r,u;if(t){if(i=new String(t).toString(),r=i.match(n.kg.sortService.dateRE),!r)if(u=new Date(i),u){if(i=u.toLocaleDateString(),r=i.match(n.kg.sortService.dateRE),!r)return}else return;return r}}},l=function(){var t=$("<div><\/div>");t.appendTo("body"),t.height(100).width(100).css("position","absolute").css("overflow","scroll"),t.append('<div style="height: 400px; width: 400px;"><\/div>'),n.kg.domUtilityService.ScrollH=t.height()-t[0].clientHeight,n.kg.domUtilityService.ScrollW=t.width()-t[0].clientWidth,t.empty(),t.attr("style",""),t.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M<\/strong><\/span>'),n.kg.domUtilityService.LetterW=t.children().first().width(),t.remove()},n.kg.domUtilityService={AssignGridContainers:function(t,i){i.$root=$(t),i.$topPanel=i.$root.find(".kgTopPanel"),i.$groupPanel=i.$root.find(".kgGroupPanel"),i.$headerContainer=i.$topPanel.find(".kgHeaderContainer"),i.$headerScroller=i.$topPanel.find(".kgHeaderScroller"),i.$headers=i.$headerScroller.children(),i.$viewport=i.$root.find(".kgViewport"),i.$canvas=i.$viewport.find(".kgCanvas"),i.$footerPanel=i.$root.find(".ngFooterPanel"),n.kg.domUtilityService.UpdateGridLayout(i)},UpdateGridLayout:function(n){if(typeof n.$viewport!="undefined"){var t=n.$viewport.scrollTop();n.elementDims.rootMaxW=n.$root.width(),n.elementDims.rootMaxH=n.$root.height(),n.refreshDomSizes(),n.adjustScrollTop(t,!0)}},BuildStyles:function(t){var s=t.config.rowHeight,r=t.$styleSheet,i=t.gridId,f,h=t.visibleColumns(),e=0,u,o;t.$viewport!=null&&t.$viewport!=undefined&&ko.unwrap(t.config.viewPortOptions.isfixed)&&ko.unwrap(t.config.viewPortOptions.maxRows)<t.filteredData().length&&t.$viewport.css("overflow-y","scroll"),r||(r=$("#"+i),r[0]||(r=$("<style id='"+i+"' type='text/css' rel='stylesheet' />"),r.appendTo("body"))),r.empty(),u=t.totalRowWidth(),f="."+i+" .kgCanvas { width: "+u+"px; }."+i+" .kgRow { width: "+u+"px; }."+i+" .kgCell { height: "+s+"px; }."+i+" .kgCanvas { width: "+u+"px; }."+i+" .kgHeaderCell { top: 0; bottom: 0}."+i+" .kgHeaderScroller { width: "+(u+n.kg.domUtilityService.ScrollH+2)+"px}",t.config.isHeaderHeightFixed&&(f+="."+i+" .kgHeaderFixed {white-space: nowrap}"),o=2,navigator.userAgent.toLowerCase().indexOf("firefox")!=-1&&(o=22),$.each(h,function(n,t){f+="."+i+" .col"+n+" { width: "+t.width+"px; left: "+(e-1)+"px; right: "+(u-e-t.width)+"px; height: "+s+"px }."+i+" .hcol"+n+" { max-width: "+(t.width-1)+"px;min-width: "+(t.width-1)+"px;}."+i+" .colt"+n+" { width: "+(t.width-o)+"px; }",e+=t.width}),n.kg.utils.isIe?r[0].styleSheet.cssText=f:r.append(document.createTextNode(f)),t.$styleSheet=r},ScrollH:17,ScrollW:17,LetterW:10},l()})(window);
//@ sourceMappingURL=koGrid-2.1.1.debug.min.js.map